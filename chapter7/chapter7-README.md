# chapter 7
イベント駆動プログラミング・ビデオゲームを書く

Unixマシンは始終多くの端末や他のデバイスからデータを受信している。ユーザは予測不能なタイミングで
端末データを生成するが、カーネルはそれらのキーストロークを処理しなければならない。
また、Unixマシンは複数のプログラムを実行しなければならない。カーネルはどのようにして複数のことの
同時実行を管理し、複数の予測不能な割り込みに応答しているのか。私たちは、ビデオゲームを書いてこの問題を考えていく。

”画面管理”、”時間”、”シグナル”、”共有リソース（複数の処理を安全に実行する）”
この４つの基本トピックについて学ぶために、キャラクタベース端末用のビデオゲームを書く

”画面管理”：curses library 
”時間”： interval timer ( setitimer(2), struct itimerval )
”シグナル”： signal, sigaction

”共有リソース”： (複数の処理を安全に実行する）：混乱を防ぐ方法
=> クリティカルセクション（データ構造の書き換え中に割り込みがかかるとデータが不完全になったり壊れたりする場合、
データ構造を書き換える一連のコードをクリティカルセクションと呼ぶ。
シグナル（ソフトウェア割り込み）を操作するプログラムを書くときは、クリティカルセクションを見極め、
その部分を保護するようにしなければならない、クリティカルセクションを手っ取り早く保護したければ、
データを使ったり書き換えたりするハンドラを呼び出すシグナルをブロックするか、無視する。

再入可能なコード ( reentrant function )
すでにアクティブになっている時に呼び出される可能性があり、しかも何も問題を起こす危険性のない
シグナルハンドラ（あるいは、それ以外の関数）を再入可能な関数と呼ぶ。

入力時のシグナル：非同期入出力
Unix 非同期入出力(asynchronous input)のため２つのシステムを組み込んでいる。

・入力が読み出せる状態になった時にシグナルを送る
 set file descriptor  : O_ASYNC

・入力を読んだ後にシグナルを送る
 using aio_read ( POSIX )
check aio(4) to play bounce_aio.c ( set vfs.aio.enable_unsafe 1 from zero )
[makoto@BSD ~/repos/uulp/chapter7]$ sysctl -a | grep vfs.aio.enable_unsafe
 vfs.aio.enable_unsafe: 1


